/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package quotes;
import com.google.gson.Gson;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.lang.reflect.Type;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.nio.file.Files;
import java.nio.file.Paths;

public class App {
    public String getGreeting() {
        return "Hello world.";
    }
    public static void main(String[] args) throws IOException {
        Quote[] quotes = gsonify("src/main/resources/happyFile.json");
        int indici = (int)(Math.random()*quotes.length);
        addQuote(quotes, getStarWarsQuote());

    }



        public static String getStarWarsQuote() throws IOException {
        URL starWarsQuotesAPIURL= new URL("http://swquotesapi.digitaljedi.dk/api/SWQuote/RandomStarWarsQuote");
        HttpURLConnection connection = (HttpURLConnection) starWarsQuotesAPIURL.openConnection();
        BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream()));
        StringBuilder data =new StringBuilder();
        String line = reader.readLine();
        System.out.println(line.toString());
        while(line != null) {
            data.append(line);
            line = reader.readLine();
        }
        data.toString();
//        https://stackoverflow.com/questions/40910779/how-to-remove-all-characters-before-a-specific-character-in-java/40910835
        String modData = data.substring(data.indexOf(",")+1);
            System.out.println(modData +" after sub");
        modData= modData.replace("\"starWarsQuote\"", "{\"text\"");
        return modData;
        }



        public static Quote[] addQuote(Quote[] arr, String newQoute){
            Quote[] extendedQuoteArray = new Quote [arr.length+1];
            Gson gson = new Gson();
            System.out.println(newQoute);
            Quote quoteToadd = gson.fromJson(newQoute, Quote.class);
            extendedQuoteArray[extendedQuoteArray.length-1] = quoteToadd;
            return extendedQuoteArray;
        };


        public static Quote[] gsonify(String filePath) throws IOException {
            Gson gson = new Gson();
            Quote[] quoteArr = gson.fromJson(new String(Files.readAllBytes(Paths.get(filePath))), Quote[].class);
            return quoteArr;
    }

        public static Quote random(Quote[] arr){
            int indici = (int)(Math.random()*arr.length);
            return arr[indici];
        }
}
